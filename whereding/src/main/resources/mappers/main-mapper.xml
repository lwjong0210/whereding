<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >

<mapper namespace="mainMapper">
	<resultMap type="HashTag" id="tagResultSet">
		<result column="product_no" property="productNo"></result>
		<result column="tag_content" property="tagContent"></result>
	</resultMap>
	
	<resultMap type="Hall" id="hallResultSet">
		<result column="h_code" property="code"></result>
		<result column="h_enterprise" property="enterprise"></result>
		<result column="h_name" property="name"></result>
		<result column="h_detail" property="detail"></result>
		<result column="h_seat" property="seat"></result>
		<result column="h_rental" property="rental"></result>
		<result column="h_restaurant_seat" property="hallSeat"></result>
		<result column="h_meal" property="meal"></result>
		<result column="h_start_time" property="startTime"></result>
		<result column="h_end_time" property="endTime"></result>
		<result column="h_phone" property="phone"></result>
		<result column="h_address" property="address"></result>
		<result column="h_unit_time" property="unitTime"></result>
		<result column="h_week_open" property="weekOpen"></result>
	</resultMap>
	<resultMap type="Studio" id="studioResultSet">
		<result column="s_code" property="stCode"></result>
		<result column="s_enterprise" property="stEnterprise"></result>
		<result column="s_detail" property="stDetail"></result>
		<result column="s_price" property="stPrice"></result>
		<result column="s_start_time" property="stStartTime"></result>
		<result column="s_end_time" property="stEndTime"></result>
		<result column="s_phone" property="phone"></result>
		<result column="s_address" property="address"></result>
		<result column="s_unit_time" property="unitTime"></result>
		<result column="s_week_open" property="weekOpen"></result>
	</resultMap>
	<resultMap type="Dress" id="dressResultSet">
		<result column="d_code" property="drCode"></result>
		<result column="d_enterprise" property="drEnterprise"></result>
		<result column="d_detail" property="drDetail"></result>
		<result column="d_price" property="drPrice"></result>
		<result column="d_start_time" property="drStartTime"></result>
		<result column="d_end_time" property="drEndTime"></result>
		<result column="d_phone" property="phone"></result>
		<result column="d_address" property="address"></result>
		<result column="d_unit_time" property="unitTime"></result>
		<result column="d_week_open" property="weekOpen"></result>
	</resultMap>
	<resultMap type="Makeup" id="makeupResultSet">
		<result column="m_code" property="maCode"></result>
		<result column="m_enterprise" property="maEnterprise"></result>
		<result column="m_detail" property="maDetail"></result>
		<result column="m_price" property="maPrice"></result>
		<result column="m_start_time" property="maStartTime"></result>
		<result column="m_end_time" property="maEndTime"></result>
		<result column="m_phone" property="phone"></result>
		<result column="m_address" property="address"></result>
		<result column="m_unit_time" property="unitTime"></result>
		<result column="m_week_open" property="weekOpen"></result>
	</resultMap>
	<resultMap type="Basket" id="basketResultSet">
		<result column="user_no" property="userNo"></result>
		<result column="gift_name" property="giftName"></result>
		<result column="gift_price" property="giftPrice"></result>
		<result column="file_path" property="filePath"></result>
		<result column="refNo" property="refNo"></result>
		<result column="count" property="count"></result>
	</resultMap>
	<resultMap type="Reservation" id="reservationResultSet">
		<result column="company_no" property="companyNo"></result>
		<result column="enterprise" property="enterprise"></result>
		<result column="address" property="address"></result>
		<result column="phone" property="phone"></result>
		<result column="filePath" property="filePath"></result>
	</resultMap>
	
		<!-- 
			private String wAddress;
			private String wTag;
		 -->

	<select id="selectTagList" resultMap="tagResultSet">
		select
			   product_no
			 , tag_content
		  from 
		  	   tag
		 where
		 <if test="category == 'wedding'">
		 	product_no like 'H%'
		 </if>
		 <if test="category == 'studio'">
		 	product_no like 'S%'
		 </if>
		 <if test="category == 'dress'">
		 	product_no like 'D%'
		 </if>
		 <if test="category == 'makeup'">
		 	product_no like 'M%'
		 </if>
	</select>

	<select id ="selectHallList" resultMap="hallResultSet">
		select 
			   *
		  from hall
		  left join tag on(h_code = product_no)
		 where h_rental between #{wMinPrice}*10000 and #{wMaxPrice}*10000
		   and h_meal between #{eatMinPrice}*10000 and #{eatMaxPrice}*10000
		   <!-- and h_address like #{wAddress} || '%'
		   and tag_content like '%' || --> 
		   <if test="wSeat == 1">
		   	and h_seat between 1 and 100
		   </if>
   		   <if test="wSeat == 2">
		   	and h_seat between 101 and 300
		   </if>
   		   <if test="wSeat == 3">
		   	and h_seat between 301 and 500
		   </if>
   		   <if test="wSeat == 4">
		   	and h_seat > 500
		   </if>
	</select>
	<!-- 
	<select id="selectStudioList" resultMap="studioResultSet">
		select 
		       *    
		  from studio
		  left join tag on(s_code = product_no)
		 where s_price between #{sMinPrice}*10000 and #{sMaxPrice}*10000
 		   <choose>
 		   	<when test="sWeek eq 'on'">
			   and s_week_open = 'Y' 
 		   	</when>
 		   	<otherwise>
 		   		and s_week_open = 'N' 
 		   	</otherwise>
 		   </choose>
	</select>
	<select id="selectDressList" resultMap="dressResultSet">
		select 
		       *    
		  from dress
		  left join tag on(d_code = product_no)
		 where d_price between #{dMinPrice}*10000 and #{dMaxPrice}*10000
 		   <choose>
 		   	<when test="dWeek eq 'on'">
			   and d_week_open = 'Y' 
 		   	</when>
 		   	<otherwise>
 		   		and d_week_open = 'N' 
 		   	</otherwise>
 		   </choose>
	
	</select>
	<select id="selectMakeupList" resultMap="makeupResultSet">
		select 
		       *    
		  from makeup
		  left join tag on(m_code = product_no)
		 where m_price between #{mMinPrice}*10000 and #{mMaxPrice}*10000
 		   <choose>
 		   	<when test="mWeek eq 'on'">
			   and m_week_open = 'Y' 
 		   	</when>
 		   	<otherwise>
 		   		and m_week_open = 'N' 
 		   	</otherwise>
 		   </choose>
	</select> -->
	
	
	<select id="searchStudioList" resultMap="studioResultSet">
		select 
		       *    
		  from studio
		  left join tag on(s_code = product_no)
		 where s_price between #{sMinPrice}*10000 and #{sMaxPrice}*10000
 		   <choose>
 		   	<when test="sWeek eq 'on'">
			   and s_week_open = 'Y' 
 		   	</when>
 		   	<otherwise>
 		   		and s_week_open = 'N' 
 		   	</otherwise>
 		   </choose>
 		   <if test="sTag!=null and sTag neq ''">
	 		   <foreach item="arr" collection="sTag" open="and(" close=")" separator="or">
	                  tag_content like '%'||#{arr}||'%'
		      </foreach>
 		   </if>
	      <foreach item= "arr" collection="sAddress" open="and(" close=")" separator="or">
	      			s_address like #{arr} ||'%' 
	      </foreach>
	</select>
	<select id="searchDressList" resultMap="dressResultSet">
		select 
		       *    
		  from dress
		  left join tag on(d_code = product_no)
		 where d_price between #{dMinPrice}*10000 and #{dMaxPrice}*10000
 		   <choose>
 		   	<when test="dWeek eq 'on'">
			   and d_week_open = 'Y' 
 		   	</when>
 		   	<otherwise>
 		   		and d_week_open = 'N' 
 		   	</otherwise>
 		   </choose>
 		   <if test="dTag!=null and dTag neq ''">
	 		   <foreach item="arr" collection="dTag" open="and(" close=")" separator="or">
	                  tag_content like '%'||#{arr}||'%'
		      </foreach>
 		   </if>
	      <foreach item= "arr" collection="dAddress" open="and(" close=")" separator="or">
	      			d_address like #{arr} ||'%' 
	      </foreach>
	</select>
	<select id="searchMakeupList" resultMap="makeupResultSet">
		select 
		       *    
		  from makeup
		  left join tag on(m_code = product_no)
		 where m_price between #{mMinPrice}*10000 and #{mMaxPrice}*10000
 		   <choose>
 		   	<when test="mWeek eq 'on'">
			   and m_week_open = 'Y' 
 		   	</when>
 		   	<otherwise>
 		   		and m_week_open = 'N' 
 		   	</otherwise>
 		   </choose>
 		   <if test="mTag!=null and !mTag.equals('')">
	 		   <foreach item="arr" collection="mTag" open="and(" close=")" separator="or">
	                  tag_content like '%'||#{arr}||'%'
		      </foreach>
 		   </if>
	      <foreach item= "arr" collection="mAddress" open="and(" close=")" separator="or">
	      			m_address like #{arr} ||'%' 
	      </foreach>
	</select>
	<select id="selectBasketList" resultMap="basketResultSet">
		select 
		       user_id
		     , gift_name
		     , gift_price
		     , b.count
	         , g_file_path || '/' || g_change_name as file_path
		  from member
		 right join basket b using (user_no)
		       join gift on(ref_no = gift_no) 
               join gift_img on (gift_no = review_no)
	  		   where user_no = #{userNo}
	</select>
	
	<select id="selectRsvList" resultMap="reservationResultSet">
		select 
		       company_no
		     , s_enterprise || d_enterprise || m_enterprise as enterprise 
		     , s_address || d_address || m_address as address
		     , s_phone || d_phone || m_phone as phone
		     , img_path || img_1 as filepath
		  from rsv_basket
		  left join studio s on (company_no = s_code)
		  left join dress d on (company_no = d_code)
		  left join makeup m on (company_no = m_code)
		  left join product_img on (company_no = product_no)
		 where user_no = #{userNo}
	</select>
	
</mapper>